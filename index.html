<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Options Yield Finder</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="chart.css">
    <link rel="stylesheet" href="yield.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>Options Yield Finder</h1>
            <p class="subtitle">Find the highest yielding options to sell</p>
        </header>

        <!-- API Key Setup -->
        <div id="api-key-section" style="display:none; background:#1a1a2e; border:1px solid #4a9eff; border-radius:8px; padding:16px 20px; margin-bottom:20px;">
            <h3 style="margin:0 0 8px; color:#4a9eff; font-size:1rem;">Site Password Required</h3>
            <p style="margin:0 0 12px; font-size:0.875rem; color:#aaa;">This tool is private. Enter the password shared with you. It will be saved in your browser.</p>
            <div style="display:flex; gap:8px; align-items:center;">
                <input type="password" id="api-key-input" placeholder="Enter site password" style="flex:1; padding:8px 12px; border-radius:6px; border:1px solid #444; background:#0d0d1a; color:#fff; font-size:0.875rem;">
                <button onclick="submitApiKey()" style="padding:8px 16px; background:#4a9eff; color:#fff; border:none; border-radius:6px; cursor:pointer; font-size:0.875rem;">Save</button>
            </div>
        </div>

        <main>
            <section class="input-section">
                <h2>Select Option Contract</h2>

                <!-- Ticker Input -->
                <div class="ticker-lookup">
                    <div class="input-group">
                        <label for="ticker">Stock Ticker</label>
                        <div class="ticker-input-wrapper">
                            <input type="text" id="ticker" placeholder="e.g., AAPL" maxlength="5">
                        </div>
                    </div>
                    <div id="stock-name" class="stock-name"></div>
                    <div id="fetch-status" class="status-message"></div>
                </div>

                <!-- Stock Price Display -->
                <div class="stock-quote-display">
                    <div class="quote-item">
                        <span class="quote-label">Stock Price</span>
                        <span class="quote-value" id="stock-price-display">--</span>
                    </div>
                    <div class="quote-item">
                        <span class="quote-label">Bid</span>
                        <span class="quote-value" id="stock-bid">--</span>
                    </div>
                    <div class="quote-item">
                        <span class="quote-label">Ask</span>
                        <span class="quote-value" id="stock-ask">--</span>
                    </div>
                </div>

                <!-- Option Type Selector -->
                <div class="option-type-selector">
                    <label>Option Type</label>
                    <div class="toggle-group">
                        <button class="toggle-btn" data-type="call" onclick="setOptionType('call')">Call</button>
                        <button class="toggle-btn active" data-type="put" onclick="setOptionType('put')">Put</button>
                    </div>
                </div>

                <!-- Expiration Date Selector -->
                <div class="input-group">
                    <label for="expiration-select">Expiration Date</label>
                    <select id="expiration-select" onchange="onExpirationChange()">
                        <option value="">-- Select Expiration --</option>
                    </select>
                </div>

                <!-- Days to Maturity (Auto-calculated) -->
                <div class="input-group">
                    <label>Days to Maturity</label>
                    <div class="calculated-value" id="days-to-maturity">--</div>
                </div>

                <!-- Strike Price Selector -->
                <div class="input-group">
                    <label for="strike-select">Strike Price</label>
                    <select id="strike-select" onchange="onStrikeChange()">
                        <option value="">-- Select Strike --</option>
                    </select>
                </div>

                <!-- Strike % of Stock Price (OTM indicator) -->
                <div class="otm-display" id="otm-section" style="display: none;">
                    <div class="otm-content">
                        <span class="otm-label">Strike as % of Stock Price</span>
                        <span class="otm-value" id="strike-percent">--</span>
                        <span class="otm-status" id="otm-status">--</span>
                    </div>
                </div>

                <!-- Option Contract Identifiers (shows on strike selection) -->
                <div class="option-identifiers" id="option-identifiers-section" style="display: none;">
                    <div class="identifier-row">
                        <div class="identifier-item">
                            <span class="identifier-label">Option Ticker (OCC Symbol)</span>
                            <span class="identifier-value" id="option-ticker">--</span>
                        </div>
                    </div>
                    <div class="identifier-row">
                        <div class="identifier-item">
                            <span class="identifier-label">FIGI</span>
                            <span class="identifier-value" id="option-figi">--</span>
                        </div>
                    </div>
                </div>

                <!-- Quick Quote Preview (shows immediately on strike selection) -->
                <div class="quick-quote-display" id="quick-quote-section" style="display: none;">
                    <div class="quick-quote-grid">
                        <div class="quick-quote-card bid">
                            <span class="quick-quote-label">Bid</span>
                            <span class="quick-quote-value" id="quick-bid">--</span>
                        </div>
                        <div class="quick-quote-card ask">
                            <span class="quick-quote-label">Ask</span>
                            <span class="quick-quote-value" id="quick-ask">--</span>
                        </div>
                        <div class="quick-quote-card mid">
                            <span class="quick-quote-label">Mid Price</span>
                            <span class="quick-quote-value" id="quick-mid">--</span>
                            <span class="quick-quote-sublabel">(Bid + Ask) / 2</span>
                        </div>
                    </div>
                </div>

                <button class="calculate-btn" onclick="fetchOptionQuote()">Get Full Quote & Analysis</button>

                <!-- Option Bid/Ask Display -->
                <div class="option-quote-display" id="option-quote-section" style="display: none;">
                    <h3>Market Option Quote</h3>

                    <!-- Current Price Hero (used for yield calculation) -->
                    <div class="current-price-hero">
                        <span class="current-price-label">Current Price (Mid)</span>
                        <span class="current-price-value" id="current-price">--</span>
                        <span class="current-price-sublabel">Average of Bid & Ask - Used for Yield Calculation</span>
                    </div>

                    <!-- Bid/Ask Grid -->
                    <div class="bid-ask-grid">
                        <div class="quote-card bid">
                            <span class="quote-card-label">Bid</span>
                            <span class="quote-card-value" id="option-bid">--</span>
                            <span class="quote-card-sublabel">Sell at this price</span>
                        </div>
                        <div class="quote-card ask">
                            <span class="quote-card-label">Ask</span>
                            <span class="quote-card-value" id="option-ask">--</span>
                            <span class="quote-card-sublabel">Buy at this price</span>
                        </div>
                        <div class="quote-card last">
                            <span class="quote-card-label">Last Trade</span>
                            <span class="quote-card-value" id="option-last">--</span>
                            <span class="quote-card-sublabel">Most recent</span>
                        </div>
                    </div>

                    <!-- Volume & Open Interest (Prominent) -->
                    <div class="volume-oi-grid">
                        <div class="volume-oi-card">
                            <span class="volume-oi-label">Today's Volume</span>
                            <span class="volume-oi-value" id="option-volume">--</span>
                            <span class="volume-oi-sublabel">Contracts traded today</span>
                        </div>
                        <div class="volume-oi-card">
                            <span class="volume-oi-label">Open Interest</span>
                            <span class="volume-oi-value" id="option-oi">--</span>
                            <span class="volume-oi-sublabel">Outstanding contracts</span>
                        </div>
                    </div>

                    <!-- IV -->
                    <div class="iv-display">
                        <span class="iv-label">Implied Volatility</span>
                        <span class="iv-value" id="option-iv">--</span>
                    </div>

                    <!-- Copy Order Button -->
                    <button class="copy-order-btn" onclick="copyOrderToClipboard()">
                        <span class="copy-icon">üìã</span> Copy Order Details for Schwab
                    </button>
                    <div id="copy-status" class="copy-status"></div>
                </div>
            </section>

            <section class="results-section">
                <h2>Market Greeks</h2>
                <p class="section-subtitle">From MarketData.app options data</p>

                <div class="greeks-grid">
                    <div class="greek-card">
                        <div class="greek-header">
                            <span class="greek-symbol">Œî</span>
                            <span class="greek-name">Delta</span>
                        </div>
                        <span class="greek-value" id="delta">--</span>
                        <span class="greek-desc">Price sensitivity to stock movement</span>
                    </div>
                    <div class="greek-card">
                        <div class="greek-header">
                            <span class="greek-symbol">Œì</span>
                            <span class="greek-name">Gamma</span>
                        </div>
                        <span class="greek-value" id="gamma">--</span>
                        <span class="greek-desc">Delta sensitivity to stock movement</span>
                    </div>
                    <div class="greek-card">
                        <div class="greek-header">
                            <span class="greek-symbol">Œò</span>
                            <span class="greek-name">Theta</span>
                        </div>
                        <span class="greek-value" id="theta">--</span>
                        <span class="greek-desc">Daily time decay (per day)</span>
                    </div>
                    <div class="greek-card">
                        <div class="greek-header">
                            <span class="greek-symbol">V</span>
                            <span class="greek-name">Vega</span>
                        </div>
                        <span class="greek-value" id="vega">--</span>
                        <span class="greek-desc">Sensitivity to 1% volatility change</span>
                    </div>
                    <div class="greek-card">
                        <div class="greek-header">
                            <span class="greek-symbol">œÅ</span>
                            <span class="greek-name">Rho</span>
                        </div>
                        <span class="greek-value" id="rho">--</span>
                        <span class="greek-desc">Sensitivity to 1% rate change</span>
                    </div>
                </div>

                <h3>Black-Scholes Comparison</h3>
                <p class="section-subtitle">Theoretical pricing for reference</p>
                <div class="price-display">
                    <div class="price-card">
                        <span class="price-label">BS Theoretical Price</span>
                        <span class="price-value" id="bs-price">--</span>
                    </div>
                    <div class="price-card">
                        <span class="price-label">Intrinsic Value</span>
                        <span class="price-value" id="intrinsic-value">--</span>
                    </div>
                    <div class="price-card">
                        <span class="price-label">Time Value</span>
                        <span class="price-value" id="time-value">--</span>
                    </div>
                </div>
            </section>
        </main>

        <!-- Seller's Yield Analysis - Prominent Section -->
        <section class="yield-section">
            <h2>Seller's Yield Analysis</h2>
            <p class="yield-subtitle">Premium income for selling this option (using mid price: avg of bid & ask)</p>

            <!-- Contract Input and Premium Calculator -->
            <div class="contract-calculator">
                <div class="contract-input-group">
                    <label for="yield-contracts">Number of Contracts</label>
                    <input type="number" id="yield-contracts" value="1" min="1" max="9999" onchange="updatePremiumCalculation()" oninput="updatePremiumCalculation()">
                </div>
                <div class="premium-results">
                    <div class="premium-card">
                        <span class="premium-label">Projected Premium Received</span>
                        <span class="premium-value" id="projected-premium">--</span>
                        <span class="premium-formula">Contracts √ó 100 √ó Mid Price</span>
                    </div>
                    <div class="premium-card">
                        <span class="premium-label">Total Notional Exposure</span>
                        <span class="premium-value" id="total-notional">--</span>
                        <span class="premium-formula">Strike √ó Contracts √ó 100</span>
                    </div>
                </div>
            </div>

            <div class="yield-hero">
                <div class="yield-hero-card">
                    <span class="yield-hero-label">Annualized Yield</span>
                    <span class="yield-hero-value" id="annualized-yield">--%</span>
                    <span class="yield-hero-sublabel">Based on <span id="dte-display">--</span> days to expiry</span>
                </div>
            </div>

            <div class="yield-grid">
                <div class="yield-card">
                    <span class="yield-label">Premium Yield (Period)</span>
                    <span class="yield-value" id="period-yield">--%</span>
                    <span class="yield-desc">Premium / Stock Price</span>
                </div>
                <div class="yield-card">
                    <span class="yield-label">Premium per Day</span>
                    <span class="yield-value" id="premium-per-day">--</span>
                    <span class="yield-desc">Daily theta income</span>
                </div>
                <div class="yield-card">
                    <span class="yield-label">Monthly Equivalent</span>
                    <span class="yield-value" id="monthly-yield">--%</span>
                    <span class="yield-desc">If repeated 12x/year</span>
                </div>
                <div class="yield-card">
                    <span class="yield-label">Capital Required</span>
                    <span class="yield-value" id="capital-required">--</span>
                    <span class="yield-desc" id="capital-desc">To secure position</span>
                </div>
            </div>

            <div class="yield-assigned">
                <h3>If Assigned at Expiration</h3>
                <div class="yield-assigned-grid">
                    <div class="yield-card">
                        <span class="yield-label">Total Return if Assigned</span>
                        <span class="yield-value" id="assigned-return">--%</span>
                        <span class="yield-desc" id="assigned-desc">Premium + stock gain/loss</span>
                    </div>
                    <div class="yield-card">
                        <span class="yield-label">Annualized if Assigned</span>
                        <span class="yield-value" id="assigned-annualized">--%</span>
                        <span class="yield-desc">Total return annualized</span>
                    </div>
                    <div class="yield-card">
                        <span class="yield-label">Effective Buy/Sell Price</span>
                        <span class="yield-value" id="effective-price">--</span>
                        <span class="yield-desc" id="effective-desc">Net cost basis</span>
                    </div>
                </div>
            </div>
        </section>

        <section class="chart-section">
            <h2>Profit/Loss Diagram</h2>
            <div class="chart-controls">
                <div class="chart-toggle">
                    <label>Position:</label>
                    <div class="toggle-group small">
                        <button class="toggle-btn" data-position="long" onclick="setPosition('long')">Long</button>
                        <button class="toggle-btn active" data-position="short" onclick="setPosition('short')">Short</button>
                    </div>
                </div>
                <div class="chart-toggle">
                    <label>Contracts:</label>
                    <input type="number" id="num-contracts" value="1" min="1" max="100" onchange="updateChart()">
                </div>
                <div class="chart-legend">
                    <span class="legend-item"><span class="legend-line at-expiry"></span> At Expiry</span>
                    <span class="legend-item"><span class="legend-line current"></span> Current P/L</span>
                    <span class="legend-item"><span class="legend-marker breakeven"></span> Breakeven</span>
                    <span class="legend-item"><span class="legend-marker current-price"></span> Current Price</span>
                </div>
            </div>
            <div class="chart-container">
                <canvas id="pl-chart"></canvas>
                <div class="chart-tooltip" id="chart-tooltip"></div>
            </div>
            <div class="chart-stats">
                <div class="stat-card profit">
                    <span class="stat-label">Max Profit</span>
                    <span class="stat-value" id="max-profit">--</span>
                </div>
                <div class="stat-card loss">
                    <span class="stat-label">Max Loss</span>
                    <span class="stat-value" id="max-loss">--</span>
                </div>
                <div class="stat-card">
                    <span class="stat-label">Risk/Reward</span>
                    <span class="stat-value" id="risk-reward">--</span>
                </div>
                <div class="stat-card">
                    <span class="stat-label">Breakeven</span>
                    <span class="stat-value" id="chart-breakeven">--</span>
                </div>
            </div>
        </section>

        <footer>
            <p>Real-time options data from MarketData.app. Black-Scholes shown for reference only. | <a href="#" onclick="changeApiKey(); return false;" style="color:#4a9eff;">Change Password</a></p>
        </footer>
    </div>

    <script src="black-scholes.js"></script>
    <script src="chart.js"></script>
    <script src="app.js"></script>
</body>
</html>
